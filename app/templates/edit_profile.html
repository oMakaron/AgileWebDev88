{% extends "base.html" %}
{% block title %}Edit Profile â€“ DataVizApp{% endblock %}

{% block content %}

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=True) %}
  {% if messages %}
    <div x-data="{ show: true }" x-init="setTimeout(() => show = false, 10000)" x-show="show"
         x-transition:enter="transition ease-out duration-500"
         x-transition:enter-start="opacity-0 -translate-y-5"
         x-transition:enter-end="opacity-100 translate-y-0"
         x-transition:leave="transition ease-in duration-300"
         x-transition:leave-start="opacity-100 translate-y-0"
         x-transition:leave-end="opacity-0 -translate-y-5"
         class="fixed top-6 left-1/2 transform -translate-x-1/2 
                bg-white border-l-4 shadow-lg rounded px-6 py-4 z-50 w-[300px]"
         :class="{
            'border-green-500': '{{ messages[0][0] }}' === 'success',
            'border-red-500': '{{ messages[0][0] }}' === 'error'
         }">
      
      <div class="flex justify-between items-center">
        <div class="text-sm font-medium"
             :class="{
               'text-green-700': '{{ messages[0][0] }}' === 'success',
               'text-red-700': '{{ messages[0][0] }}' === 'error'
             }">
          {% for category, message in messages %}
            {{ message }}
          {% endfor %}
        </div>
        <button @click="show = false" class="ml-4 text-gray-400 hover:text-gray-600 font-bold text-lg leading-none">&times;</button>
      </div>

      <div class="h-1 mt-2 overflow-hidden rounded"
           :class="{
             'bg-green-200': '{{ messages[0][0] }}' === 'success',
             'bg-red-200': '{{ messages[0][0] }}' === 'error'
           }">
        <div class="h-full animate-toast-progress"
             :class="{
               'bg-green-500': '{{ messages[0][0] }}' === 'success',
               'bg-red-500': '{{ messages[0][0] }}' === 'error'
             }"></div>
      </div>
    </div>
  {% endif %}
{% endwith %}

<!-- Form Card -->
<div class="max-w-xl mx-auto bg-white shadow-xl p-8 rounded-lg mt-20">
  <h2 class="text-2xl font-bold mb-6">Edit Profile</h2>

  <form method="POST" class="space-y-5" x-data="{ showPasswordFields: false }">
    {{ form.hidden_tag() }}

    <!-- Name -->
    <div>
      {{ form.name.label(class="block text-sm font-medium text-gray-700") }}
      {{ form.name(class="w-full mt-1 p-2 border border-gray-300 rounded-lg") }}
    </div>

    <!-- Email -->
    <div>
      {{ form.email.label(class="block text-sm font-medium text-gray-700") }}
      {{ form.email(class="w-full mt-1 p-2 border border-gray-300 rounded-lg") }}
    </div>

    <!-- Current Password -->
    <div>
      {{ form.current_password.label(class="block text-sm font-medium text-gray-700") }}
      {{ form.current_password(class="w-full mt-1 p-2 border border-gray-300 rounded-lg") }}
    </div>

    <!-- Toggle Password Fields -->
    <button type="button"
            @click="showPasswordFields = !showPasswordFields"
            class="text-blue-600 hover:underline text-sm font-medium">
      Change Password
    </button>

    <!-- Password Fields -->
    <div x-show="showPasswordFields" x-transition>
      <div>
        {{ form.new_password.label(class="block text-sm font-medium text-gray-700") }}
        {{ form.new_password(class="w-full mt-1 p-2 border border-gray-300 rounded-lg") }}
      </div>
      <div>
        {{ form.confirm_password.label(class="block text-sm font-medium text-gray-700") }}
        {{ form.confirm_password(class="w-full mt-1 p-2 border border-gray-300 rounded-lg") }}
      </div>
    </div>

    <!-- Submit -->
    {{ form.submit(class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700") }}
  </form>
</div>
{% endblock %}

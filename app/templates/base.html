<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}DataVizApp{% endblock %}</title>
  <link href="{{ url_for('static', filename='css/output.css') }}" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  {{ moment.include_moment() }}
</head>
<body class="h-screen overflow-hidden">

  <!-- Sidebar -->
  <aside
    id="sidebar"
    class="fixed inset-y-0 left-0 w-64 bg-gray-900 text-white p-6
           transform translate-x-0
           transition-transform duration-300 ease-in-out
           z-20"
  >
    <h1 class="text-2xl font-bold mb-8">DataVizApp</h1>
    <nav class="space-y-4 text-lg">
      <a href="/dashboard" class="block hover:text-blue-400">Home</a>
      <a href="/generate-graph" class="block hover:text-blue-400">Generate Graph</a>
      <a href="/friends"   class="block hover:text-blue-400">Share</a>
      <a href="/profile"   class="block hover:text-blue-400">Profile</a>
    </nav>
  </aside>

  <!-- Toggle pill -->
  <button
    id="toggleSidebar"
    class="fixed top-1/2 left-64 transform -translate-y-1/2
           bg-gray-800 text-white rounded-r-full p-2 shadow
           hover:bg-gray-700 focus:outline-none
           transition-all duration-300 ease-in-out
           z-30"
  >⮜</button>

  <!-- Main content -->
  <div
    id="mainContent"
    class="ml-64 transition-all duration-300 ease-in-out
           h-full overflow-auto bg-gray-100"
  >
    <header class="flex items-center bg-gray-100 text-gray-900 px-6 h-14 shadow">
      <!-- App Name -->
      <h1 class="text-xl font-bold">DataVizApp</h1>

      <!-- Navigation Links -->
      <nav class="ml-8 flex space-x-6 text-sm">
        <a href="/dashboard" class="hover:text-blue-600">Dashboard</a>
        <a href="/analytics" class="hover:text-blue-600">Analytics</a>
        <a href="/settings" class="hover:text-blue-600">Settings</a>
      </nav>

      <!-- Action Buttons -->
      <div class="ml-auto flex items-center space-x-4 relative">
        <!-- Notifications Button -->
        <div class="relative z-40">
          <button id="notificationsBtn" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 flex items-center space-x-2">
            <span class="flex items-center">
              Notifications
              {% if unread_count > 0 %}
                <span class="ml-1 w-2.5 h-2.5 bg-red-600 rounded-full inline-block"></span>
              {% endif %}
            </span>

            <svg id="notificationsArrow" class="w-4 h-4 ml-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path id="arrowPath" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          
          <!-- Dropdown -->
          <div id="notificationsDropdown" class="hidden absolute right-0 mt-2 w-64 bg-white border border-gray-300 rounded shadow-lg">
            <ul class="divide-y divide-gray-200 max-h-64 overflow-y-auto">
              {% if notifications %}
                {% for n in notifications %}
                  <li class="p-4 text-sm text-gray-800 hover:bg-gray-100 {% if not n.is_read %} bg-blue-50 {% endif %}">
                    {{ n.message }}
                    <div class="text-xs text-gray-500 mt-1">{{ moment(n.timestamp).fromNow() }}</div>
                  </li>
                {% endfor %}
              {% else %}
                <li class="p-4 text-sm text-gray-500">No notifications.</li>
              {% endif %}
            </ul>
          </div>
        </div>

        <!-- Logout Button -->
        <button onclick="location.href='/logout'" class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">
          Logout
        </button>
      </div>
    </header>
    <main class="p-6">
      {% block content %}{% endblock %}
    </main>
  </div>

  <script>
    const sidebar     = document.getElementById('sidebar');
    const mainContent = document.getElementById('mainContent');
    const toggleBtn   = document.getElementById('toggleSidebar');

    toggleBtn.addEventListener('click', () => {
      const isOpen = sidebar.classList.contains('translate-x-0');

      if (isOpen) {
        // slide it out
        sidebar.classList.replace('translate-x-0', '-translate-x-full');
        mainContent.classList.replace('ml-64', 'ml-0');
        toggleBtn.classList.replace('left-64', 'left-0');
        toggleBtn.innerHTML = '⮞';
      } else {
        // slide it back
        sidebar.classList.replace('-translate-x-full', 'translate-x-0');
        mainContent.classList.replace('ml-0', 'ml-64');
        toggleBtn.classList.replace('left-0', 'left-64');
        toggleBtn.innerHTML = '⮜';
      }
    });

    const notificationsBtn = document.getElementById('notificationsBtn');
    const notificationsDropdown = document.getElementById('notificationsDropdown');
    const notificationsArrow = document.getElementById('notificationsArrow');
    const arrowPath = document.getElementById('arrowPath');

    // Toggle dropdown visibility and arrow direction
    notificationsBtn.addEventListener('click', () => {
      notificationsDropdown.classList.toggle('hidden');
      const isOpen = !notificationsDropdown.classList.contains('hidden');
      arrowPath.setAttribute('d', isOpen ? 'M19 15l-7-7-7 7' : 'M19 9l-7 7-7-7');

      if (isOpen) {
      fetch("/notifications/read", { method: "POST" });

      const redDot = document.querySelector('#notificationsBtn .bg-red-600.rounded-full');
      if (redDot) {
        redDot.remove();
       }
      }
    });
      
    // Close dropdown when clicking outside
    document.addEventListener('click', (event) => {
      if (!notificationsBtn.contains(event.target) && !notificationsDropdown.contains(event.target)) {
        notificationsDropdown.classList.add('hidden');
        // Reset arrow to point down
        arrowPath.setAttribute('d', 'M19 9l-7 7-7-7');
      }
    });
  </script>
<div class="hidden">
  text-white text-red-600 text-red-500 bg-red-600 bg-red-500 text-[10px] font-bold rounded-full
</div>
</body>
</html>


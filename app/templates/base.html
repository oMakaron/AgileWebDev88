<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}DataVizApp{% endblock %}</title>
  <link href="{{ url_for('static', filename='css/output.css') }}" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>
<body class="h-screen overflow-hidden">
  {% with messages = get_flashed_messages(with_categories=True) %}
    {% for category, message in messages %}
      <div
        x-data="{ show: true }"
        x-init="setTimeout(() => show = false, 10000)"
        x-show="show"
        x-transition:enter="transition ease-out duration-500"
        x-transition:enter-start="opacity-0 -translate-y-5"
        x-transition:enter-end="opacity-100 translate-y-0"
        x-transition:leave="transition ease-in duration-300"
        x-transition:leave-start="opacity-100 translate-y-0"
        x-transition:leave-end="opacity-0 -translate-y-5"
        class="fixed top-6 left-1/2 transform -translate-x-1/2 
              bg-white border-l-4 shadow-lg rounded 
              px-6 py-4 z-50 w-[300px]
              {% if category == 'success' %}
                border-green-500
              {% elif category == 'error' %}
                border-red-500
              {% else %}
                border-gray-500
              {% endif %}"
      >
        <div class="flex justify-between items-center">
          <div class="text-sm font-medium
                      {% if category == 'success' %} text-green-700
                      {% elif category == 'error' %} text-red-700
                      {% else %} text-gray-700
                      {% endif %}">
            {{ message }}
          </div>
          <button @click="show = false" class="ml-4 text-gray-400 hover:text-gray-600 font-bold text-lg leading-none">
            &times;
          </button>
        </div>

        <!-- Progress bar -->
        <div class="h-1 mt-2 bg-gray-200 overflow-hidden rounded">
          <div class="h-full
                      {% if category == 'success' %} bg-green-500
                      {% elif category == 'error' %} bg-red-500
                      {% else %} bg-gray-500
                      {% endif %}
                      animate-toast-progress"></div>
        </div>
      </div>
    {% endfor %}
  {% endwith %}
  <!-- Sidebar -->
  <aside
    id="sidebar"
    class="fixed inset-y-0 left-0 w-64 bg-gray-900 text-white p-6
           transform translate-x-0
           transition-transform duration-300 ease-in-out
           z-20"
  >
    <h1 class="text-2xl font-bold mb-8">DataVizApp</h1>
    <nav class="space-y-4 text-lg">
      <a href="/dashboard" class="block hover:text-blue-400">Home</a>
      <a href="/generate-graph" class="block hover:text-blue-400">Generate Graph</a>
      <a href="/friends"   class="block hover:text-blue-400">Share</a>
      <a href="/profile"   class="block hover:text-blue-400">Profile</a>
      <a href="{{ url_for('routes.shared_with_me') }}" class="block hover:text-blue-400">
        Message Received
      </a>
    </nav>
  </aside>

  <!-- Toggle pill -->
  <button
    id="toggleSidebar"
    class="fixed top-1/2 left-64 transform -translate-y-1/2
           bg-gray-800 text-white rounded-r-full p-2 shadow
           hover:bg-gray-700 focus:outline-none
           transition-all duration-300 ease-in-out
           z-30"
  >⮜</button>

  <!-- Main content -->
  <div
    id="mainContent"
    class="ml-64 transition-all duration-300 ease-in-out
           h-full overflow-auto bg-gray-100"
  >
    <header class="flex items-center bg-gray-100 text-gray-900 px-6 h-14 shadow">
      <!-- App Name -->
      <h1 class="text-xl font-bold">DataVizApp</h1>

      <!-- Navigation Links -->
      <nav class="ml-8 flex space-x-6 text-sm">
        <a href="/dashboard" class="hover:text-blue-600">Dashboard</a>
        <a href="/settings" class="hover:text-blue-600">Settings</a>
      </nav>

      <!-- Action Buttons -->
      <div class="ml-auto flex items-center space-x-4 relative">
        <!-- Notifications Button -->
        <div class="relative">
          <button id="notificationsBtn" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 flex items-center space-x-2">
            <span>Notifications</span>
            <svg id="notificationsArrow" class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path id="arrowPath" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <!-- Dropdown -->
          <div id="notificationsDropdown" class="hidden absolute right-0 mt-2 w-64 bg-white border border-gray-300 rounded shadow-lg">
            <ul class="divide-y divide-gray-200">
              <li class="p-4 text-sm">New comment on your post</li>
              <li class="p-4 text-sm">Your report is ready</li>
              <li class="p-4 text-sm">System update available</li>
            </ul>
            <button class="w-full text-center py-2 bg-gray-100 hover:bg-gray-200 text-sm font-medium">
              Read All
            </button>
          </div>
        </div>

        <!-- Logout Button -->
        <button onclick="location.href='/logout'" class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">
          Logout
        </button>
      </div>
    </header>
    <main class="p-6">
      {% block content %}{% endblock %}
    </main>
  </div>

  <script>
    const sidebar     = document.getElementById('sidebar');
    const mainContent = document.getElementById('mainContent');
    const toggleBtn   = document.getElementById('toggleSidebar');

    toggleBtn.addEventListener('click', () => {
      const isOpen = sidebar.classList.contains('translate-x-0');

      if (isOpen) {
        // slide it out
        sidebar.classList.replace('translate-x-0', '-translate-x-full');
        mainContent.classList.replace('ml-64', 'ml-0');
        toggleBtn.classList.replace('left-64', 'left-0');
        toggleBtn.innerHTML = '⮞';
      } else {
        // slide it back
        sidebar.classList.replace('-translate-x-full', 'translate-x-0');
        mainContent.classList.replace('ml-0', 'ml-64');
        toggleBtn.classList.replace('left-0', 'left-64');
        toggleBtn.innerHTML = '⮜';
      }
    });

    const notificationsBtn = document.getElementById('notificationsBtn');
    const notificationsDropdown = document.getElementById('notificationsDropdown');
    const notificationsArrow = document.getElementById('notificationsArrow');
    const arrowPath = document.getElementById('arrowPath');

    // Toggle dropdown visibility and arrow direction
    notificationsBtn.addEventListener('click', () => {
      notificationsDropdown.classList.toggle('hidden');
      if (notificationsDropdown.classList.contains('hidden')) {
        // Arrow points down
        arrowPath.setAttribute('d', 'M19 9l-7 7-7-7');
      } else {
        // Arrow points up
        arrowPath.setAttribute('d', 'M19 15l-7-7-7 7');
      }
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (event) => {
      if (!notificationsBtn.contains(event.target) && !notificationsDropdown.contains(event.target)) {
        notificationsDropdown.classList.add('hidden');
        // Reset arrow to point down
        arrowPath.setAttribute('d', 'M19 9l-7 7-7-7');
      }
    });
  </script>
{% block scripts %}{% endblock %}
</body>
</html>
